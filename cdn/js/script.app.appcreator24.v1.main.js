document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("appReviewForm"),c=document.getElementById("appImage"),u=document.getElementById("appImagePreview"),n=document.getElementById("messageBox"),a=document.getElementById("messageText");document.getElementById("submitButton");const p=document.getElementById("loadingOverlay");function g(e,t="info"){a.textContent=e,n.classList.remove("success","error","info"),n.classList.add(t),n.style.display="block"}c.addEventListener("change",e=>{var t,e=e.target.files[0];e?((t=new FileReader).onload=e=>{u.innerHTML=`<img src="${e.target.result}" alt="App Preview">`},t.readAsDataURL(e)):u.innerHTML='<span class="text-gray-400 text-sm">معاينة الصورة</span>'}),r.addEventListener("submit",async e=>{e.preventDefault();var e=document.getElementById("developerName").value,t=document.getElementById("developerGmail").value,n=document.getElementById("packageName").value,a=document.getElementById("appVersion").value,s=document.getElementById("downloadLink").value,l=c.files[0];if(l){p.style.display="flex";try{var o,d=new FormData,i={title:"طلب مراجعة نشر تطبيق جديد",description:"تم استلام طلب جديد لمراجعة تطبيق.",color:7924478,fields:[{name:"اسم المطور",value:e,inline:!0},{name:"جيمايل المطور",value:t,inline:!0},{name:"اسم الحزمة",value:n,inline:!1},{name:"الإصدار",value:a,inline:!0},{name:"رابط تحميل التطبيق",value:s,inline:!1}],image:{url:"attachment://"+l.name},timestamp:(new Date).toISOString()},m=(d.append("payload_json",JSON.stringify({embeds:[i]})),d.append("file",l,l.name),await fetch("https://discord.com/api/webhooks/1381480536127832186/73YuZtgnmTje34plfBjEG-zS-xy6PGza5fVh0iWH3OnkinXWtqb4QaXan09WJWdCodif",{method:"POST",body:d}));m.ok?(g("تم إرسال طلبك بنجاح! سيتم مراجعته قريباً.","success"),r.reset(),u.innerHTML='<span class="text-gray-400 text-sm">معاينة الصورة</span>'):(o=await m.json(),console.error("خطأ في إرسال البيانات إلى Discord:",m.status,o),g(`فشل إرسال الطلب: ${m.status} - `+(o.message||"خطأ غير معروف"),"error"))}catch(e){console.error("خطأ في الاتصال بالشبكة:",e),g("حدث خطأ في الاتصال. الرجاء المحاولة مرة أخرى.","error")}finally{p.style.display="none"}}else g("الرجاء رفع صورة التطبيق.","error")})});